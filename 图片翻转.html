
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE> New Document </TITLE>
<META NAME="Generator" CONTENT="EditPlus">
<META NAME="Author" CONTENT="">
<META NAME="Keywords" CONTENT="">
<META NAME="Description" CONTENT="">
<link href="style/reset.css" rel="stylesheet" type="text/css" />
<link href="style/global.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--
.rotation {background:transparent url(game_x5.png) no-repeat 0 0;width:90px;height:22px;border-

width:0;cursor:pointer;display:block;float:right;}
img{padding:2px;border:1px solid #ccc;}
-->
</style>


<script type="text/javascript">
<!--
	var isIE = /*@cc_on!@*/!1;
	function rotationPicture(img) {
		if (!img) return;
		this._img = typeof img == 'string'?document.getElementById(img):img;
		this.r = 1;
		this.addBtn();
		this.bind();
	}
	rotationPicture.prototype.addBtn = function() {
		this._rRight = document.createElement('BUTTON');
		this._rRight.setAttribute('id','rRight');
		this._rRight.className = 'rotation';
		if (!isIE){
			var canvas = document.createElement('CANVAS');
			var ctx = canvas.getContext('2d');
			canvas.setAttribute('width',this._img.width);
			canvas.setAttribute('height',this._img.height);
			ctx.drawImage(this._img,0,0);
			this._ghost = this._img;
			this._img.parentNode.replaceChild(canvas,this._img);
			this._img = canvas;
		}
		this._img.parentNode.insertBefore(this._rRight,this._img);
	};
	rotationPicture.prototype.bind = function(){
	var _this = this;
	if (window.attachEvent){
		this._rRight.attachEvent('onclick',rotation);
	}else{
		this._rRight.addEventListener('click',rotation,false);
	}

	function rotation(){
		if (_this.r > 3) _this.r = 0;
			if(isIE){
				_this._img.style.filter = 'progid:DXImageTransform.Microsoft.BasicImage(Rotation=' + _this.r + ')';
			}else{
				var ctx = _this._img.getContext('2d');
				switch (_this.r){
					case 0:
						_this._img.setAttribute('width',_this._ghost.width);
						_this._img.setAttribute('height',_this._ghost.height);
						ctx.drawImage(_this._ghost,0,0);
						break;
					case 1:
						_this._img.setAttribute('width',_this._ghost.height);
						_this._img.setAttribute('height',_this._ghost.width);
						ctx.rotate(90*Math.PI/180);
						ctx.drawImage(_this._ghost,0,-_this._ghost.height);
						break;
					case 2:
						_this._img.setAttribute('width',_this._ghost.width);
						_this._img.setAttribute('height',_this._ghost.height);
						ctx.rotate(180*Math.PI/180);
						ctx.drawImage(_this._ghost,-_this._ghost.width,-_this._ghost.height);
						break;
					case 3:
						_this._img.setAttribute('width',_this._ghost.height);
						_this._img.setAttribute('height',_this._ghost.width);
						ctx.rotate(270*Math.PI/180);
						ctx.drawImage(_this._ghost,-_this._ghost.width,0);
						break;
				}
			}
			_this.r++;
		}
	};

	//打开调用函数
	window.onload = function(){
		var ir = new rotationPicture('pic_xz');
	};
-->

</script>
</HEAD>

<BODY>
<div id="container">
	<div class="head">
		<h1>CSS+JS实现图片旋转</h1>
		<h2>(<a href="http://www.chinesefeng.com">前端技术</a>)-<strong><a href="http://www.zfsoft.com">zfsoftUED</a></strong></h2>
	</div>

	<div class="info">
		<h3><span>相关说明</span></h3>
		<ul>
		<li><strong>文档类型：</strong>XHTML 1.0 Transitional</li>
		<li><strong>测试通过：</strong>IE6+,FF3+,Chrome</li>
		<li><strong>应用范围：</strong>方便用户查看一些扫描进数据库,但是显示不正常的图片.</li>

		</ul>
	</div>
	<div class="content">
		<img src="13010419720806361X.jpg" id="pic_xz" alt="顺时针旋转图片" />
	</div>
</div>
</BODY>
</HTML>

